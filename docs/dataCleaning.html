<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.39">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Data Cleaning – Sondondo Project Notebooks</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script><script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-e26003cea8cd680ca0c55a263523d882.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-6bd9cfa162949bde0a231f530c97869d.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>

<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>


</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">Sondondo Project Notebooks</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="./index.html"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-notebooks" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Notebooks</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-notebooks">    
        <li>
    <a class="dropdown-item" href="./dataCleaning.html">
 <span class="dropdown-text">Data Cleaning</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./placeMapping.html">
 <span class="dropdown-text">Place Mapping</span></a>
  </li>  
    </ul>
  </li>
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#raw-datasets" id="toc-raw-datasets" class="nav-link active" data-scroll-target="#raw-datasets">Raw Datasets</a></li>
  <li><a href="#column-harmonization" id="toc-column-harmonization" class="nav-link" data-scroll-target="#column-harmonization">Column Harmonization</a>
  <ul class="collapse">
  <li><a href="#reduce-dataframes-to-their-relevant-columns" id="toc-reduce-dataframes-to-their-relevant-columns" class="nav-link" data-scroll-target="#reduce-dataframes-to-their-relevant-columns">Reduce DataFrames to their relevant columns</a></li>
  </ul></li>
  <li><a href="#replace-empty-or-null-values-with-na" id="toc-replace-empty-or-null-values-with-na" class="nav-link" data-scroll-target="#replace-empty-or-null-values-with-na">Replace empty or null values with ‘na’</a></li>
  <li><a href="#dates-normalization" id="toc-dates-normalization" class="nav-link" data-scroll-target="#dates-normalization">Dates Normalization</a></li>
  <li><a href="#age-inferring" id="toc-age-inferring" class="nav-link" data-scroll-target="#age-inferring">Age Inferring</a></li>
  <li><a href="#names-normalization" id="toc-names-normalization" class="nav-link" data-scroll-target="#names-normalization">Names Normalization</a></li>
  <li><a href="#place-recognition" id="toc-place-recognition" class="nav-link" data-scroll-target="#place-recognition">Place Recognition</a></li>
  <li><a href="#cleaning-audit" id="toc-cleaning-audit" class="nav-link" data-scroll-target="#cleaning-audit">Cleaning Audit</a></li>
  <li><a href="#save-cleaned-data" id="toc-save-cleaned-data" class="nav-link" data-scroll-target="#save-cleaned-data">Save Cleaned Data</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Data Cleaning</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p>This notebook handles the data cleaning process for the datasets, documenting the process at the same time.</p>
<div id="9959a5d1" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Libraries</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> json</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> re</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pathlib <span class="im">import</span> Path</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="raw-datasets" class="level2">
<h2 class="anchored" data-anchor-id="raw-datasets">Raw Datasets</h2>
<p>The raw datasets are stored in the <code>data/raw</code> directory. The datasets include:</p>
<ul>
<li><code>bautismos.csv</code>: Baptism records</li>
<li><code>matrimonios.csv</code>: Marriage records</li>
<li><code>entierros.csv</code>: Burial records</li>
</ul>
<div id="1f2fc54b" class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>BAUTISMOS_RAW <span class="op">=</span> pd.read_csv(<span class="st">"../data/raw/bautismos.csv"</span>)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>MATRIMONIOS_RAW <span class="op">=</span> pd.read_csv(<span class="st">"../data/raw/matrimonios.csv"</span>)</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>ENTIERROS_RAW <span class="op">=</span> pd.read_csv(<span class="st">"../data/raw/entierros.csv"</span>)</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>BAUTISMOS_RAW.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="2">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Secuencia</th>
<th data-quarto-table-cell-role="th">Unidad Documental Compuesta (a la que pertenece)</th>
<th data-quarto-table-cell-role="th">Identificador (es recomendable seguir una secuencia numeral como la mostrada en los ejemplos)</th>
<th data-quarto-table-cell-role="th">Título (incluir un título breve para cada documento)</th>
<th data-quarto-table-cell-role="th">Folio inicial del documento (convertir como se muestra abajo)</th>
<th data-quarto-table-cell-role="th">Folio final del documento (convertir como se muestra abajo)</th>
<th data-quarto-table-cell-role="th">Imagen inicial (estos valores serán añadidos cuando comienze el proceso de revisión de imágenes)</th>
<th data-quarto-table-cell-role="th">Imagen final (estos valores serán añadidos cuando comienze el proceso de revisión de imágenes)</th>
<th data-quarto-table-cell-role="th">Tipo de evento</th>
<th data-quarto-table-cell-role="th">Fecha aaaa-mm-dd</th>
<th data-quarto-table-cell-role="th">...</th>
<th data-quarto-table-cell-role="th">Condición de la madrina</th>
<th data-quarto-table-cell-role="th">Lugar de bautizo</th>
<th data-quarto-table-cell-role="th">Notas adicionales del documento</th>
<th data-quarto-table-cell-role="th">Descriptor Geográfico 1</th>
<th data-quarto-table-cell-role="th">Descriptor Geográfico 2</th>
<th data-quarto-table-cell-role="th">Descriptor Geográfico 3</th>
<th data-quarto-table-cell-role="th">Descriptor Geográfico 4</th>
<th data-quarto-table-cell-role="th">5</th>
<th data-quarto-table-cell-role="th">Características físicas (Estado de conservación de los materiales físicos)</th>
<th data-quarto-table-cell-role="th">Historia de revisión (de los materiales digitalizados)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>1.0</td>
<td>APAucará LB L001</td>
<td>B001</td>
<td>Bautizo. Domingo. Tributarios</td>
<td>3r</td>
<td>3r</td>
<td>IMG_7000a</td>
<td>IMG_7000a</td>
<td>Bautizo</td>
<td>1790-10-04</td>
<td>...</td>
<td>NaN</td>
<td>Pampamarca, iglesia</td>
<td>NaN</td>
<td>Aucara</td>
<td>Pampamarca</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>Regular</td>
<td>Registrado por Edwin Gonzales en 2023</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>2.0</td>
<td>APAucará LB L001</td>
<td>B002</td>
<td>Bautizo. Dominga. Tributarios</td>
<td>3r</td>
<td>3r</td>
<td>IMG_7000a</td>
<td>IMG_7000a</td>
<td>Bautizo</td>
<td>1790-10-06</td>
<td>...</td>
<td>NaN</td>
<td>Pampamarca, iglesia</td>
<td>NaN</td>
<td>Aucara</td>
<td>Pampamarca</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>Regular</td>
<td>Registrado por Edwin Gonzales en 2023</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>3.0</td>
<td>APAucará LB L001</td>
<td>B003</td>
<td>Bautizo. Bartola. Tributarios</td>
<td>3r</td>
<td>3r</td>
<td>IMG_7000a</td>
<td>IMG_7000a</td>
<td>Bautizo</td>
<td>1790-10-07</td>
<td>...</td>
<td>NaN</td>
<td>Pampamarca, iglesia</td>
<td>NaN</td>
<td>Aucara</td>
<td>Pampamarca</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>Regular</td>
<td>Registrado por Edwin Gonzales en 2023</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>4.0</td>
<td>APAucará LB L001</td>
<td>B004</td>
<td>Bautizo. Francisca</td>
<td>3v</td>
<td>3v</td>
<td>IMG_7000b</td>
<td>IMG_7000b</td>
<td>Bautizo</td>
<td>1790-10-20</td>
<td>...</td>
<td>NaN</td>
<td>Aucara, iglesia</td>
<td>Abreviatura poco visible en el margen</td>
<td>Aucara</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>Regular</td>
<td>Registrado por Edwin Gonzales en 2023</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>5.0</td>
<td>APAucará LB L001</td>
<td>B005</td>
<td>Bautizo. Pedro</td>
<td>3v</td>
<td>3v</td>
<td>IMG_7000b</td>
<td>IMG_7000b</td>
<td>Bautizo</td>
<td>1790-10-20</td>
<td>...</td>
<td>NaN</td>
<td>Aucara, iglesia</td>
<td>Margen roto y manchado de tinta</td>
<td>Aucara</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>Regular</td>
<td>Registrado por Edwin Gonzales en 2023</td>
</tr>
</tbody>
</table>

<p>5 rows × 36 columns</p>
</div>
</div>
</div>
</section>
<section id="column-harmonization" class="level2">
<h2 class="anchored" data-anchor-id="column-harmonization">Column Harmonization</h2>
<p>Rename the columns in the datasets to ensure consistency across different data sources.</p>
<p>Values are mapped using the <code>json</code> files located in the <code>data/mappings</code> directory.</p>
<div id="29ef8524" class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> utils.ColumnManager <span class="im">import</span> ColumnManager</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="0e0ec6d5" class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>bautismoMapping <span class="op">=</span> Path(<span class="st">"../data/mappings/bautismosMapping.json"</span>)</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>matrimonioMapping <span class="op">=</span> Path(<span class="st">"../data/mappings/matrimoniosMapping.json"</span>)</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>entierroMapping <span class="op">=</span> Path(<span class="st">"../data/mappings/entierrosMapping.json"</span>)</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>column_manager <span class="op">=</span> ColumnManager()</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>BAUTISMOS_HARMONIZED <span class="op">=</span> column_manager.harmonize_columns(BAUTISMOS_RAW, bautismoMapping)</span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>MATRIMONIOS_HARMONIZED <span class="op">=</span> column_manager.harmonize_columns(MATRIMONIOS_RAW, matrimonioMapping)</span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>ENTIERROS_HARMONIZED <span class="op">=</span> column_manager.harmonize_columns(ENTIERROS_RAW, entierroMapping)</span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>BAUTISMOS_HARMONIZED.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="4">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">id</th>
<th data-quarto-table-cell-role="th">file</th>
<th data-quarto-table-cell-role="th">identifier</th>
<th data-quarto-table-cell-role="th">title</th>
<th data-quarto-table-cell-role="th">start_folio</th>
<th data-quarto-table-cell-role="th">end_folio</th>
<th data-quarto-table-cell-role="th">start_image</th>
<th data-quarto-table-cell-role="th">end_image</th>
<th data-quarto-table-cell-role="th">event_type</th>
<th data-quarto-table-cell-role="th">date</th>
<th data-quarto-table-cell-role="th">...</th>
<th data-quarto-table-cell-role="th">godmother_social_condition</th>
<th data-quarto-table-cell-role="th">baptism_place</th>
<th data-quarto-table-cell-role="th">additional_notes</th>
<th data-quarto-table-cell-role="th">geographic_descriptor_1</th>
<th data-quarto-table-cell-role="th">geographic_descriptor_2</th>
<th data-quarto-table-cell-role="th">geographic_descriptor_3</th>
<th data-quarto-table-cell-role="th">geographic_descriptor_4</th>
<th data-quarto-table-cell-role="th">other</th>
<th data-quarto-table-cell-role="th">record_physical_characteristics</th>
<th data-quarto-table-cell-role="th">revision_history</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>1.0</td>
<td>APAucará LB L001</td>
<td>B001</td>
<td>Bautizo. Domingo. Tributarios</td>
<td>3r</td>
<td>3r</td>
<td>IMG_7000a</td>
<td>IMG_7000a</td>
<td>Bautizo</td>
<td>1790-10-04</td>
<td>...</td>
<td>NaN</td>
<td>Pampamarca, iglesia</td>
<td>NaN</td>
<td>Aucara</td>
<td>Pampamarca</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>Regular</td>
<td>Registrado por Edwin Gonzales en 2023</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>2.0</td>
<td>APAucará LB L001</td>
<td>B002</td>
<td>Bautizo. Dominga. Tributarios</td>
<td>3r</td>
<td>3r</td>
<td>IMG_7000a</td>
<td>IMG_7000a</td>
<td>Bautizo</td>
<td>1790-10-06</td>
<td>...</td>
<td>NaN</td>
<td>Pampamarca, iglesia</td>
<td>NaN</td>
<td>Aucara</td>
<td>Pampamarca</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>Regular</td>
<td>Registrado por Edwin Gonzales en 2023</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>3.0</td>
<td>APAucará LB L001</td>
<td>B003</td>
<td>Bautizo. Bartola. Tributarios</td>
<td>3r</td>
<td>3r</td>
<td>IMG_7000a</td>
<td>IMG_7000a</td>
<td>Bautizo</td>
<td>1790-10-07</td>
<td>...</td>
<td>NaN</td>
<td>Pampamarca, iglesia</td>
<td>NaN</td>
<td>Aucara</td>
<td>Pampamarca</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>Regular</td>
<td>Registrado por Edwin Gonzales en 2023</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>4.0</td>
<td>APAucará LB L001</td>
<td>B004</td>
<td>Bautizo. Francisca</td>
<td>3v</td>
<td>3v</td>
<td>IMG_7000b</td>
<td>IMG_7000b</td>
<td>Bautizo</td>
<td>1790-10-20</td>
<td>...</td>
<td>NaN</td>
<td>Aucara, iglesia</td>
<td>Abreviatura poco visible en el margen</td>
<td>Aucara</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>Regular</td>
<td>Registrado por Edwin Gonzales en 2023</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>5.0</td>
<td>APAucará LB L001</td>
<td>B005</td>
<td>Bautizo. Pedro</td>
<td>3v</td>
<td>3v</td>
<td>IMG_7000b</td>
<td>IMG_7000b</td>
<td>Bautizo</td>
<td>1790-10-20</td>
<td>...</td>
<td>NaN</td>
<td>Aucara, iglesia</td>
<td>Margen roto y manchado de tinta</td>
<td>Aucara</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>Regular</td>
<td>Registrado por Edwin Gonzales en 2023</td>
</tr>
</tbody>
</table>

<p>5 rows × 36 columns</p>
</div>
</div>
</div>
<section id="reduce-dataframes-to-their-relevant-columns" class="level3">
<h3 class="anchored" data-anchor-id="reduce-dataframes-to-their-relevant-columns">Reduce DataFrames to their relevant columns</h3>
<div id="b8809026" class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>useful_columns <span class="op">=</span> json.load(<span class="bu">open</span>(<span class="st">"../data/mappings/usefulColumnsMapping.json"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="965be0bd" class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Bautismos useful columns</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>BAUTISMOS_HARMONIZED <span class="op">=</span> BAUTISMOS_HARMONIZED[useful_columns[<span class="st">'bautizo'</span>]]</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a><span class="co"># remove empty columns</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>BAUTISMOS_HARMONIZED.dropna(axis<span class="op">=</span><span class="dv">1</span>, how<span class="op">=</span><span class="st">'all'</span>, inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>BAUTISMOS_HARMONIZED.columns</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="6">
<pre><code>Index(['file', 'identifier', 'event_type', 'date', 'baptized_name',
       'baptized_hometown', 'baptized_birth_date',
       'baptized_legitimacy_status', 'father_name', 'father_lastname',
       'father_social_condition', 'mother_name', 'mother_lastname',
       'mother_social_condition', 'parents_social_condition', 'godfather_name',
       'godfather_lastname', 'godfather_social_condition', 'godmother_name',
       'godmother_lastname', 'godmother_social_condition', 'baptism_place',
       'geographic_descriptor_1', 'geographic_descriptor_2',
       'geographic_descriptor_3', 'geographic_descriptor_4'],
      dtype='object')</code></pre>
</div>
</div>
<div id="933b4eeb" class="cell" data-execution_count="7">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>MATRIMONIOS_HARMONIZED <span class="op">=</span> MATRIMONIOS_HARMONIZED[useful_columns[<span class="st">'matrimonio'</span>]]</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="co"># remove empty columns</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>MATRIMONIOS_HARMONIZED.dropna(axis<span class="op">=</span><span class="dv">1</span>, how<span class="op">=</span><span class="st">'all'</span>, inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>MATRIMONIOS_HARMONIZED.columns</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="7">
<pre><code>Index(['file', 'identifier', 'event_type', 'date', 'groom_name',
       'groom_lastname', 'groom_social_condition', 'groom_marital_status',
       'groom_age', 'groom_hometown', 'groom_resident_in',
       'groom_legitimacy_status', 'groom_father_name', 'groom_father_lastname',
       'groom_father_social_condition', 'groom_mother_name',
       'groom_mother_lastname', 'groom_mother_social_condition', 'bride_name',
       'bride_lastname', 'bride_social_condition', 'bride_marital_status',
       'bride_age', 'bride_hometown', 'bride_resident_in',
       'bride_legitimacy_status', 'bride_father_name', 'bride_father_lastname',
       'bride_father_social_condition', 'bride_mother_name',
       'bride_mother_lastname', 'bride_mother_social_condition',
       'godparent_1_name', 'godparent_1_lastname',
       'godparent_1_social_condition', 'godparent_2_name',
       'godparent_2_lastname', 'godparent_2_social_condition',
       'godparent_3_name', 'godparent_3_lastname', 'witness_1_name',
       'witness_1_lastname', 'witness_2_name', 'witness_2_lastname',
       'witness_3_name', 'witness_3_lastname', 'witness_4_name',
       'witness_4_lastname', 'marriage_place', 'geographic_descriptor_1',
       'geographic_descriptor_2', 'geographic_descriptor_3',
       'geographic_descriptor_4', 'geographic_descriptor_5',
       'geographic_descriptor_6'],
      dtype='object')</code></pre>
</div>
</div>
<div id="e55f51ae" class="cell" data-execution_count="8">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>ENTIERROS_HARMONIZED <span class="op">=</span> ENTIERROS_HARMONIZED[useful_columns[<span class="st">'entierro'</span>]]</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a><span class="co"># remove empty columns</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>ENTIERROS_HARMONIZED.dropna(axis<span class="op">=</span><span class="dv">1</span>, how<span class="op">=</span><span class="st">'all'</span>, inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>ENTIERROS_HARMONIZED.columns</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="8">
<pre><code>Index(['file', 'identifier', 'event_type', 'date', 'doctrine', 'place',
       'deceased_name', 'deceased_lastname', 'deceased_age',
       'deceased_hometown', 'deceased_condition', 'deceased_marital_status',
       'deceased_legitimacy_status', 'father_name', 'father_lastname',
       'mother_name', 'mother_lastname', 'husband_name', 'wife_name',
       'burial_place', 'geographic_descriptor_1', 'geographic_descriptor_2',
       'geographic_descriptor_3', 'geographic_descriptor_4'],
      dtype='object')</code></pre>
</div>
</div>
</section>
</section>
<section id="replace-empty-or-null-values-with-na" class="level2">
<h2 class="anchored" data-anchor-id="replace-empty-or-null-values-with-na">Replace empty or null values with ‘na’</h2>
<div id="4ae727f2" class="cell" data-execution_count="9">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co">## replace cells with no textual information with numpy na</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> replace_empty_with_na(df):</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a><span class="co">    Replace placeholder strings with np.nan in string columns only.</span></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>    placeholders <span class="op">=</span> {<span class="st">''</span>, <span class="st">'-'</span>, <span class="st">'--'</span>, <span class="st">'n/a'</span>, <span class="st">'na'</span>, <span class="st">'null'</span>, <span class="st">'None'</span>}</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> clean_cell(val):</span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">isinstance</span>(val, <span class="bu">str</span>) <span class="kw">and</span> val.strip().lower() <span class="kw">in</span> placeholders:</span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> np.nan</span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> val</span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> df.<span class="bu">map</span>(clean_cell)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="1b9d73e3" class="cell" data-execution_count="10">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>BAUTISMOS_HARMONIZED <span class="op">=</span> replace_empty_with_na(BAUTISMOS_HARMONIZED)</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>MATRIMONIOS_HARMONIZED <span class="op">=</span> replace_empty_with_na(MATRIMONIOS_HARMONIZED)</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>ENTIERROS_HARMONIZED <span class="op">=</span> replace_empty_with_na(ENTIERROS_HARMONIZED)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="dates-normalization" class="level2">
<h2 class="anchored" data-anchor-id="dates-normalization">Dates Normalization</h2>
<p>Ensure dates are in a consistent format across all datasets. The dates should be in the format <code>YYYY-MM-DD</code>.</p>
<div id="00884211" class="cell" data-execution_count="11">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> actions.normalizers.DatesNormalizer <span class="im">import</span> DateNormalizer</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="42b656ef" class="cell" data-execution_count="12">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>BAUTISMOS_HARMONIZED[<span class="st">'date'</span>] <span class="op">=</span> DateNormalizer(BAUTISMOS_HARMONIZED[<span class="st">'date'</span>]).normalize()</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>BAUTISMOS_HARMONIZED[<span class="st">'date'</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="12">
<pre><code>0       1790-10-04
1       1790-10-06
2       1790-10-07
3       1790-10-20
4       1790-10-20
           ...    
6336    1888-12-10
6337    1888-12-11
6338    1888-12-12
6339    1888-12-15
6340    1888-12-16
Name: date, Length: 6341, dtype: object</code></pre>
</div>
</div>
<div id="9fd9da42" class="cell" data-execution_count="13">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>MATRIMONIOS_HARMONIZED[<span class="st">'date'</span>] <span class="op">=</span> DateNormalizer(MATRIMONIOS_HARMONIZED[<span class="st">'date'</span>]).normalize()</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>MATRIMONIOS_HARMONIZED[<span class="st">'date'</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="13">
<pre><code>0       1816-12-06
1       1816-12-12
2       1817-03-05
3       1817-03-10
4       1817-03-12
           ...    
1714    1907-10-27
1715    1908-01-13
1716    1908-01-15
1717    1908-02-15
1718    1908-03-17
Name: date, Length: 1719, dtype: object</code></pre>
</div>
</div>
<div id="257fca92" class="cell" data-execution_count="14">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>ENTIERROS_HARMONIZED[<span class="st">'date'</span>] <span class="op">=</span> DateNormalizer(ENTIERROS_HARMONIZED[<span class="st">'date'</span>]).normalize()</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>ENTIERROS_HARMONIZED[<span class="st">'date'</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="14">
<pre><code>0       1846-10-06
1       1846-10-07
2       1846-11-02
3       1846-12-08
4       1847-02-23
           ...    
2193    1920-10-12
2194    1920-10-19
2195    1920-10-19
2196    1920-10-20
2197    1920-10-21
Name: date, Length: 2198, dtype: object</code></pre>
</div>
</div>
</section>
<section id="age-inferring" class="level2">
<h2 class="anchored" data-anchor-id="age-inferring">Age Inferring</h2>
<p>Infer the age of individuals based on their birth dates and the date of the event (baptism, marriage, burial).</p>
<div id="fe2022e1" class="cell" data-execution_count="15">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> actions.generators.AgeInferrer <span class="im">import</span> AgeInferrer</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="37cbca72" class="cell" data-execution_count="17">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>BAUTISMOS_HARMONIZED[<span class="st">'baptized_birth_date'</span>] <span class="op">=</span> AgeInferrer(BAUTISMOS_HARMONIZED[<span class="st">'date'</span>]).infer_all(BAUTISMOS_HARMONIZED[<span class="st">'baptized_birth_date'</span>])</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>BAUTISMOS_HARMONIZED[[<span class="st">'date'</span>, <span class="st">'baptized_birth_date'</span>]]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="17">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">date</th>
<th data-quarto-table-cell-role="th">baptized_birth_date</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>1790-10-04</td>
<td>1790-08-04</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>1790-10-06</td>
<td>1790-08-04</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>1790-10-07</td>
<td>1790-08-04</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>1790-10-20</td>
<td>1790-10-15</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>1790-10-20</td>
<td>1790-10-19</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">6336</td>
<td>1888-12-10</td>
<td>1888-12-09</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">6337</td>
<td>1888-12-11</td>
<td>1888-12-07</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">6338</td>
<td>1888-12-12</td>
<td>1888-12-06</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">6339</td>
<td>1888-12-15</td>
<td>1888-11-30</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">6340</td>
<td>1888-12-16</td>
<td>1888-12-01</td>
</tr>
</tbody>
</table>

<p>6341 rows × 2 columns</p>
</div>
</div>
</div>
<div id="6e70b578" class="cell" data-execution_count="18">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Inconsistent dates: date should be after baptized_birth_date</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>invalid_mask <span class="op">=</span> pd.to_datetime(BAUTISMOS_HARMONIZED[<span class="st">'date'</span>], errors<span class="op">=</span><span class="st">'coerce'</span>) <span class="op">&lt;</span> pd.to_datetime(BAUTISMOS_HARMONIZED[<span class="st">'baptized_birth_date'</span>], errors<span class="op">=</span><span class="st">'coerce'</span>)</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> invalid_mask.<span class="bu">any</span>():</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"Found invalid records:"</span>)</span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(BAUTISMOS_HARMONIZED[invalid_mask][[<span class="st">'date'</span>, <span class="st">'baptized_birth_date'</span>]])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Found invalid records:
            date baptized_birth_date
135   1792-03-29          1792-04-08
290   1794-01-01          1794-01-27
671   1797-07-15          1797-07-24
2814  1900-04-01          1900-04-09</code></pre>
</div>
</div>
<blockquote class="blockquote">
<p>Unfortunately, these records were incorrectly recorded. To fix this, it is necessary to check with the original records.</p>
</blockquote>
<div id="0314f4d5" class="cell" data-execution_count="19">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>MATRIMONIOS_HARMONIZED[<span class="st">'groom_age'</span>] <span class="op">=</span> AgeInferrer(MATRIMONIOS_HARMONIZED[<span class="st">'date'</span>]).infer_all(MATRIMONIOS_HARMONIZED[<span class="st">'groom_age'</span>])</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>MATRIMONIOS_HARMONIZED[<span class="st">'bride_age'</span>] <span class="op">=</span> AgeInferrer(MATRIMONIOS_HARMONIZED[<span class="st">'date'</span>]).infer_all(MATRIMONIOS_HARMONIZED[<span class="st">'bride_age'</span>])</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>MATRIMONIOS_HARMONIZED[[<span class="st">'date'</span>, <span class="st">'groom_age'</span>, <span class="st">'bride_age'</span>]]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="19">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">date</th>
<th data-quarto-table-cell-role="th">groom_age</th>
<th data-quarto-table-cell-role="th">bride_age</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>1816-12-06</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>1816-12-12</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>1817-03-05</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>1817-03-10</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>1817-03-12</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">1714</td>
<td>1907-10-27</td>
<td>1882-11-01</td>
<td>1880-11-01</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1715</td>
<td>1908-01-13</td>
<td>1880-01-19</td>
<td>1879-01-19</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">1716</td>
<td>1908-01-15</td>
<td>1886-01-19</td>
<td>1888-01-19</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1717</td>
<td>1908-02-15</td>
<td>1883-02-20</td>
<td>1886-02-19</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">1718</td>
<td>1908-03-17</td>
<td>1880-03-23</td>
<td>1879-03-24</td>
</tr>
</tbody>
</table>

<p>1719 rows × 3 columns</p>
</div>
</div>
</div>
<div id="991f9686" class="cell" data-execution_count="20">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>ENTIERROS_HARMONIZED[<span class="st">'deceased_age'</span>] <span class="op">=</span> AgeInferrer(ENTIERROS_HARMONIZED[<span class="st">'date'</span>]).infer_all(ENTIERROS_HARMONIZED[<span class="st">'deceased_age'</span>])</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>ENTIERROS_HARMONIZED[[<span class="st">'date'</span>, <span class="st">'deceased_age'</span>]]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="20">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">date</th>
<th data-quarto-table-cell-role="th">deceased_age</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>1846-10-06</td>
<td>NaN</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>1846-10-07</td>
<td>1821-10-13</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>1846-11-02</td>
<td>1766-11-21</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>1846-12-08</td>
<td>1806-12-18</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>1847-02-23</td>
<td>1797-03-06</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2193</td>
<td>1920-10-12</td>
<td>None</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2194</td>
<td>1920-10-19</td>
<td>None</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2195</td>
<td>1920-10-19</td>
<td>None</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2196</td>
<td>1920-10-20</td>
<td>None</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2197</td>
<td>1920-10-21</td>
<td>None</td>
</tr>
</tbody>
</table>

<p>2198 rows × 2 columns</p>
</div>
</div>
</div>
</section>
<section id="names-normalization" class="level2">
<h2 class="anchored" data-anchor-id="names-normalization">Names Normalization</h2>
<p>Standardize names across datasets to ensure consistency. This includes normalizing first names, last names, and any other relevant name fields.</p>
<div id="48770e07" class="cell" data-execution_count="21">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> actions.normalizers.NamesNormalizer <span class="im">import</span> NamesNormalizer</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="bf199189" class="cell" data-execution_count="22">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> normalize_names_columns(series):</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>    namesManager <span class="op">=</span> NamesNormalizer()</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> namesManager.clean_series(series)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="fc832fa1" class="cell" data-execution_count="23">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>names_columns <span class="op">=</span> [</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">'baptized_name'</span>, </span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">'father_name'</span>, <span class="st">'father_lastname'</span>,</span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">'mother_name'</span>, <span class="st">'mother_lastname'</span>,</span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">'godfather_name'</span>, <span class="st">'godfather_lastname'</span>, </span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">'godmother_name'</span>, <span class="st">'godmother_lastname'</span>,</span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> col <span class="kw">in</span> names_columns:</span>
<span id="cb29-10"><a href="#cb29-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> col <span class="kw">in</span> BAUTISMOS_HARMONIZED.columns:</span>
<span id="cb29-11"><a href="#cb29-11" aria-hidden="true" tabindex="-1"></a>        BAUTISMOS_HARMONIZED[col] <span class="op">=</span> normalize_names_columns(BAUTISMOS_HARMONIZED[col])</span>
<span id="cb29-12"><a href="#cb29-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-13"><a href="#cb29-13" aria-hidden="true" tabindex="-1"></a>BAUTISMOS_HARMONIZED[names_columns]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="23">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">baptized_name</th>
<th data-quarto-table-cell-role="th">father_name</th>
<th data-quarto-table-cell-role="th">father_lastname</th>
<th data-quarto-table-cell-role="th">mother_name</th>
<th data-quarto-table-cell-role="th">mother_lastname</th>
<th data-quarto-table-cell-role="th">godfather_name</th>
<th data-quarto-table-cell-role="th">godfather_lastname</th>
<th data-quarto-table-cell-role="th">godmother_name</th>
<th data-quarto-table-cell-role="th">godmother_lastname</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>domingo</td>
<td>lucas</td>
<td>ayquipa</td>
<td>sevastiana</td>
<td>quispe</td>
<td>vicente</td>
<td>guamani</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>dominga</td>
<td>juan</td>
<td>lulia</td>
<td>jospha</td>
<td>gomes</td>
<td>ignacio</td>
<td>varientos</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>bartola</td>
<td>jacinto</td>
<td>quispe</td>
<td>juliana</td>
<td>chinchay</td>
<td>NaN</td>
<td>NaN</td>
<td>rotonda</td>
<td>pocco</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>francisca</td>
<td>juan</td>
<td>cuebas</td>
<td>clemenzia</td>
<td>manco</td>
<td>NaN</td>
<td>NaN</td>
<td>ysabel</td>
<td>guillen</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>pedro</td>
<td>santos</td>
<td>manxo</td>
<td>baleriana</td>
<td>arango</td>
<td>NaN</td>
<td>NaN</td>
<td>josefa</td>
<td>santiago</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">6336</td>
<td>leocadio</td>
<td>miguel</td>
<td>pacheco</td>
<td>rosa</td>
<td>huarcaya</td>
<td>josé julián</td>
<td>bendezú</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">6337</td>
<td>mariano concepcion</td>
<td>facundo</td>
<td>vega</td>
<td>silvestra</td>
<td>urbano</td>
<td>fernando</td>
<td>mancco</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">6338</td>
<td>ambrosio</td>
<td>ysidro</td>
<td>ccasane</td>
<td>rita</td>
<td>palomino</td>
<td>juan</td>
<td>tito</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">6339</td>
<td>francisco</td>
<td>mariano</td>
<td>lopez</td>
<td>leocadia</td>
<td>medina</td>
<td>feliciano</td>
<td>dias</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">6340</td>
<td>laureana</td>
<td>bernarda</td>
<td>champa</td>
<td>rufina</td>
<td>lopez</td>
<td>NaN</td>
<td>NaN</td>
<td>manuela</td>
<td>de la cruz</td>
</tr>
</tbody>
</table>

<p>6341 rows × 9 columns</p>
</div>
</div>
</div>
<div id="0e1e3696" class="cell" data-execution_count="24">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>matrimonios_names_columns <span class="op">=</span> [</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">'groom_name'</span>, <span class="st">'groom_lastname'</span>, </span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>       <span class="st">'groom_father_name'</span>, <span class="st">'groom_father_lastname'</span>, </span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>       <span class="st">'groom_mother_name'</span>, <span class="st">'groom_mother_lastname'</span>,</span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>       <span class="st">'bride_name'</span>, <span class="st">'bride_lastname'</span>,</span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a>       <span class="st">'bride_father_name'</span>, <span class="st">'bride_father_lastname'</span>,</span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a>       <span class="st">'bride_mother_name'</span>, <span class="st">'bride_mother_lastname'</span>, </span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a>       <span class="st">'godparent_1_name'</span>, <span class="st">'godparent_1_lastname'</span>,</span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a>       <span class="st">'godparent_2_name'</span>, <span class="st">'godparent_2_lastname'</span>, </span>
<span id="cb30-10"><a href="#cb30-10" aria-hidden="true" tabindex="-1"></a>       <span class="st">'godparent_3_name'</span>, <span class="st">'godparent_3_lastname'</span>, </span>
<span id="cb30-11"><a href="#cb30-11" aria-hidden="true" tabindex="-1"></a>       <span class="st">'witness_1_name'</span>, <span class="st">'witness_1_lastname'</span>, </span>
<span id="cb30-12"><a href="#cb30-12" aria-hidden="true" tabindex="-1"></a>       <span class="st">'witness_2_name'</span>, <span class="st">'witness_2_lastname'</span>,</span>
<span id="cb30-13"><a href="#cb30-13" aria-hidden="true" tabindex="-1"></a>       <span class="st">'witness_3_name'</span>, <span class="st">'witness_3_lastname'</span>, </span>
<span id="cb30-14"><a href="#cb30-14" aria-hidden="true" tabindex="-1"></a>       <span class="st">'witness_4_name'</span>, <span class="st">'witness_4_lastname'</span></span>
<span id="cb30-15"><a href="#cb30-15" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb30-16"><a href="#cb30-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-17"><a href="#cb30-17" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> col <span class="kw">in</span> matrimonios_names_columns:</span>
<span id="cb30-18"><a href="#cb30-18" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> col <span class="kw">in</span> MATRIMONIOS_HARMONIZED.columns:</span>
<span id="cb30-19"><a href="#cb30-19" aria-hidden="true" tabindex="-1"></a>        MATRIMONIOS_HARMONIZED[col] <span class="op">=</span> normalize_names_columns(MATRIMONIOS_HARMONIZED[col])</span>
<span id="cb30-20"><a href="#cb30-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-21"><a href="#cb30-21" aria-hidden="true" tabindex="-1"></a>MATRIMONIOS_HARMONIZED[matrimonios_names_columns]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="24">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">groom_name</th>
<th data-quarto-table-cell-role="th">groom_lastname</th>
<th data-quarto-table-cell-role="th">groom_father_name</th>
<th data-quarto-table-cell-role="th">groom_father_lastname</th>
<th data-quarto-table-cell-role="th">groom_mother_name</th>
<th data-quarto-table-cell-role="th">groom_mother_lastname</th>
<th data-quarto-table-cell-role="th">bride_name</th>
<th data-quarto-table-cell-role="th">bride_lastname</th>
<th data-quarto-table-cell-role="th">bride_father_name</th>
<th data-quarto-table-cell-role="th">bride_father_lastname</th>
<th data-quarto-table-cell-role="th">...</th>
<th data-quarto-table-cell-role="th">godparent_3_name</th>
<th data-quarto-table-cell-role="th">godparent_3_lastname</th>
<th data-quarto-table-cell-role="th">witness_1_name</th>
<th data-quarto-table-cell-role="th">witness_1_lastname</th>
<th data-quarto-table-cell-role="th">witness_2_name</th>
<th data-quarto-table-cell-role="th">witness_2_lastname</th>
<th data-quarto-table-cell-role="th">witness_3_name</th>
<th data-quarto-table-cell-role="th">witness_3_lastname</th>
<th data-quarto-table-cell-role="th">witness_4_name</th>
<th data-quarto-table-cell-role="th">witness_4_lastname</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>josé manl manuel</td>
<td>de la roca</td>
<td>acencio</td>
<td>roca</td>
<td>leonor</td>
<td>guerrero</td>
<td>juana</td>
<td>rodrigues</td>
<td>pedro</td>
<td>rodrigues</td>
<td>...</td>
<td>NaN</td>
<td>NaN</td>
<td>agustin</td>
<td>castro</td>
<td>mariano</td>
<td>castro</td>
<td>juan</td>
<td>baldes</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>esteban</td>
<td>castillo</td>
<td>matheo</td>
<td>castillo</td>
<td>ma maria</td>
<td>torres</td>
<td>ambrocia</td>
<td>tasqui</td>
<td>pedro</td>
<td>tasqui</td>
<td>...</td>
<td>NaN</td>
<td>NaN</td>
<td>pedro</td>
<td>manco</td>
<td>carlos</td>
<td>canto</td>
<td>pedro</td>
<td>guamani</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>alexandro</td>
<td>ramires</td>
<td>leonor</td>
<td>romani</td>
<td>franca francisca</td>
<td>paucar</td>
<td>sipriana</td>
<td>coillo</td>
<td>cristobal</td>
<td>coillo</td>
<td>...</td>
<td>NaN</td>
<td>NaN</td>
<td>marcelo</td>
<td>llamuca</td>
<td>julian</td>
<td>urbano</td>
<td>antonio</td>
<td>urbano</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>jose</td>
<td>cuchu</td>
<td>acencio</td>
<td>cuchu</td>
<td>baleriana</td>
<td>antay</td>
<td>cacimira</td>
<td>flores</td>
<td>NaN</td>
<td>NaN</td>
<td>...</td>
<td>NaN</td>
<td>NaN</td>
<td>pablo</td>
<td>roque</td>
<td>antonio</td>
<td>urbano</td>
<td>cristobal</td>
<td>coillo</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>domingo</td>
<td>tito</td>
<td>NaN</td>
<td>NaN</td>
<td>marcela</td>
<td>guauya</td>
<td>petrona</td>
<td>guallpatuiru</td>
<td>agustin</td>
<td>guallpatuiru</td>
<td>...</td>
<td>NaN</td>
<td>NaN</td>
<td>marcelo</td>
<td>llamuca</td>
<td>antonio</td>
<td>guamani</td>
<td>mariano</td>
<td>guallpatuiru</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">1714</td>
<td>patrocinio</td>
<td>chinchay</td>
<td>miguel</td>
<td>chinchay</td>
<td>andrea</td>
<td>polanco</td>
<td>lorenza</td>
<td>quispe</td>
<td>gervacio</td>
<td>quispe</td>
<td>...</td>
<td>NaN</td>
<td>NaN</td>
<td>juan de dios</td>
<td>barrientos</td>
<td>manuel</td>
<td>espinosa</td>
<td>crisostomo</td>
<td>pumarino</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1715</td>
<td>gerónimo</td>
<td>cucho</td>
<td>ambrocio</td>
<td>cucho</td>
<td>gertrudis</td>
<td>serrano</td>
<td>teresa</td>
<td>jimenes</td>
<td>aniseto</td>
<td>jimenes</td>
<td>...</td>
<td>NaN</td>
<td>NaN</td>
<td>victor</td>
<td>saravia</td>
<td>mateo</td>
<td>aiquipa</td>
<td>felix</td>
<td>cucho</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">1716</td>
<td>josé</td>
<td>coro</td>
<td>felix</td>
<td>coro</td>
<td>natividad</td>
<td>cucho</td>
<td>emilia</td>
<td>huamani</td>
<td>patricio</td>
<td>huamani</td>
<td>...</td>
<td>NaN</td>
<td>NaN</td>
<td>pablo</td>
<td>de la cruz</td>
<td>victor</td>
<td>saravia</td>
<td>marcelo</td>
<td>ramos</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1717</td>
<td>pedro</td>
<td>gutierres</td>
<td>ruperto</td>
<td>gutierrez</td>
<td>micaila</td>
<td>oscco</td>
<td>juliana</td>
<td>huarcaya</td>
<td>hilario</td>
<td>huarcaya</td>
<td>...</td>
<td>NaN</td>
<td>NaN</td>
<td>rafael</td>
<td>delgado</td>
<td>josé</td>
<td>vivanco</td>
<td>agustin</td>
<td>vicente</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">1718</td>
<td>benito</td>
<td>sanchez</td>
<td>tiburcio</td>
<td>sanchez</td>
<td>lorenza</td>
<td>aymi</td>
<td>teresa</td>
<td>poma</td>
<td>bernardo</td>
<td>poma</td>
<td>...</td>
<td>NaN</td>
<td>NaN</td>
<td>santos</td>
<td>espejo</td>
<td>felix</td>
<td>sanches</td>
<td>mariano</td>
<td>urbano</td>
<td>NaN</td>
<td>NaN</td>
</tr>
</tbody>
</table>

<p>1719 rows × 26 columns</p>
</div>
</div>
</div>
<div id="fa843fd7" class="cell" data-execution_count="25">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>entierros_names_columns <span class="op">=</span> [</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">"deceased_name"</span>, <span class="st">"deceased_lastname"</span>,</span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">"father_name"</span>, <span class="st">"father_lastname"</span>,</span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">"mother_name"</span>, <span class="st">"mother_lastname"</span>,</span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">"husband_name"</span>, <span class="st">"wife_name"</span>,</span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> col <span class="kw">in</span> entierros_names_columns:</span>
<span id="cb31-9"><a href="#cb31-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> col <span class="kw">in</span> ENTIERROS_HARMONIZED.columns:</span>
<span id="cb31-10"><a href="#cb31-10" aria-hidden="true" tabindex="-1"></a>        ENTIERROS_HARMONIZED[col] <span class="op">=</span> normalize_names_columns(ENTIERROS_HARMONIZED[col])</span>
<span id="cb31-11"><a href="#cb31-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-12"><a href="#cb31-12" aria-hidden="true" tabindex="-1"></a>ENTIERROS_HARMONIZED[entierros_names_columns]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="25">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">deceased_name</th>
<th data-quarto-table-cell-role="th">deceased_lastname</th>
<th data-quarto-table-cell-role="th">father_name</th>
<th data-quarto-table-cell-role="th">father_lastname</th>
<th data-quarto-table-cell-role="th">mother_name</th>
<th data-quarto-table-cell-role="th">mother_lastname</th>
<th data-quarto-table-cell-role="th">husband_name</th>
<th data-quarto-table-cell-role="th">wife_name</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>julian</td>
<td>xavies</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>mercedes lupa</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>joce</td>
<td>raime</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>francisca cucho</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>martina</td>
<td>condori</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>luciano ccoyllo</td>
<td>NaN</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>dorotea</td>
<td>ccoyllo</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>josé espinosa</td>
<td>NaN</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>maría</td>
<td>romani</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>mariano huallpatuiro</td>
<td>NaN</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2193</td>
<td>nieves</td>
<td>huallpatuero</td>
<td>patrocinio</td>
<td>huallpatuero</td>
<td>teresa</td>
<td>urbano</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2194</td>
<td>sinforiano</td>
<td>huamani</td>
<td>eustaquio</td>
<td>huamani</td>
<td>martina</td>
<td>llamoca</td>
<td>NaN</td>
<td>gregoria ccoillo</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2195</td>
<td>salomé</td>
<td>condori</td>
<td>sebastian</td>
<td>condori</td>
<td>anacla</td>
<td>roque</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2196</td>
<td>maría</td>
<td>chinchay</td>
<td>abdon</td>
<td>chinchay</td>
<td>floriza</td>
<td>lopez</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2197</td>
<td>fortunato</td>
<td>florez</td>
<td>cecilio</td>
<td>florez</td>
<td>guadalupe</td>
<td>ramos</td>
<td>NaN</td>
<td>NaN</td>
</tr>
</tbody>
</table>

<p>2198 rows × 8 columns</p>
</div>
</div>
</div>
</section>
<section id="place-recognition" class="level2">
<h2 class="anchored" data-anchor-id="place-recognition">Place Recognition</h2>
<p>This process involves NER recognition to extract places entities from the text fields in the datasets.</p>
<div id="c0687486" class="cell" data-execution_count="26">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> actions.extractors <span class="im">import</span> placeRecognition</span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>extractor <span class="op">=</span> placeRecognition.PlaceExtractor()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="845344dc" class="cell" data-execution_count="28">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>bautismos_place_columns <span class="op">=</span> [</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">'baptized_hometown'</span>, <span class="st">'baptism_place'</span>, <span class="st">'geographic_descriptor_1'</span>,</span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>        <span class="st">'geographic_descriptor_2'</span>, <span class="st">'geographic_descriptor_3'</span>,</span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>        <span class="st">'geographic_descriptor_4'</span></span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a>BAUTISMOS_PLACES_RAW <span class="op">=</span> BAUTISMOS_HARMONIZED[bautismos_place_columns]</span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-9"><a href="#cb33-9" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> col <span class="kw">in</span> bautismos_place_columns:</span>
<span id="cb33-10"><a href="#cb33-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> col <span class="kw">in</span> BAUTISMOS_HARMONIZED.columns:</span>
<span id="cb33-11"><a href="#cb33-11" aria-hidden="true" tabindex="-1"></a>        BAUTISMOS_HARMONIZED[col] <span class="op">=</span> extractor.extract_places_per_row(BAUTISMOS_HARMONIZED[col])</span>
<span id="cb33-12"><a href="#cb33-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-13"><a href="#cb33-13" aria-hidden="true" tabindex="-1"></a>BAUTISMOS_HARMONIZED[bautismos_place_columns]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="28">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">baptized_hometown</th>
<th data-quarto-table-cell-role="th">baptism_place</th>
<th data-quarto-table-cell-role="th">geographic_descriptor_1</th>
<th data-quarto-table-cell-role="th">geographic_descriptor_2</th>
<th data-quarto-table-cell-role="th">geographic_descriptor_3</th>
<th data-quarto-table-cell-role="th">geographic_descriptor_4</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>NaN</td>
<td>Pampamarca</td>
<td>NaN</td>
<td>Pampamarca</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>NaN</td>
<td>Pampamarca</td>
<td>NaN</td>
<td>Pampamarca</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>NaN</td>
<td>Pampamarca</td>
<td>NaN</td>
<td>Pampamarca</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>NaN</td>
<td>Aucara</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>NaN</td>
<td>Aucara</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">6336</td>
<td>NaN</td>
<td>Aucará</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">6337</td>
<td>NaN</td>
<td>Aucará</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">6338</td>
<td>NaN</td>
<td>Aucará</td>
<td>NaN</td>
<td>Mayobamba</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">6339</td>
<td>NaN</td>
<td>Aucará</td>
<td>NaN</td>
<td>Huaicahuacho</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">6340</td>
<td>NaN</td>
<td>Aucará</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
</tr>
</tbody>
</table>

<p>6341 rows × 6 columns</p>
</div>
</div>
</div>
<div id="ca8f9732" class="cell" data-execution_count="29">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>matrimonios_place_columns <span class="op">=</span> [</span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">'groom_hometown'</span>,</span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>       <span class="st">'groom_resident_in'</span>, </span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a>       <span class="st">'bride_hometown'</span>, <span class="st">'bride_resident_in'</span>, </span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a>       <span class="st">'marriage_place'</span>, <span class="st">'geographic_descriptor_1'</span>, <span class="st">'geographic_descriptor_2'</span>,</span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a>       <span class="st">'geographic_descriptor_3'</span>, <span class="st">'geographic_descriptor_4'</span>,</span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a>       <span class="st">'geographic_descriptor_5'</span>, <span class="st">'geographic_descriptor_6'</span></span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb34-9"><a href="#cb34-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-10"><a href="#cb34-10" aria-hidden="true" tabindex="-1"></a>MATRIMONIOS_PLACES_RAW <span class="op">=</span> MATRIMONIOS_HARMONIZED[matrimonios_place_columns]</span>
<span id="cb34-11"><a href="#cb34-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-12"><a href="#cb34-12" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> col <span class="kw">in</span> matrimonios_place_columns:</span>
<span id="cb34-13"><a href="#cb34-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> col <span class="kw">in</span> MATRIMONIOS_HARMONIZED.columns:</span>
<span id="cb34-14"><a href="#cb34-14" aria-hidden="true" tabindex="-1"></a>        MATRIMONIOS_HARMONIZED[col] <span class="op">=</span> extractor.extract_places_per_row(MATRIMONIOS_HARMONIZED[col])</span>
<span id="cb34-15"><a href="#cb34-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-16"><a href="#cb34-16" aria-hidden="true" tabindex="-1"></a>MATRIMONIOS_HARMONIZED[matrimonios_place_columns]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="29">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">groom_hometown</th>
<th data-quarto-table-cell-role="th">groom_resident_in</th>
<th data-quarto-table-cell-role="th">bride_hometown</th>
<th data-quarto-table-cell-role="th">bride_resident_in</th>
<th data-quarto-table-cell-role="th">marriage_place</th>
<th data-quarto-table-cell-role="th">geographic_descriptor_1</th>
<th data-quarto-table-cell-role="th">geographic_descriptor_2</th>
<th data-quarto-table-cell-role="th">geographic_descriptor_3</th>
<th data-quarto-table-cell-role="th">geographic_descriptor_4</th>
<th data-quarto-table-cell-role="th">geographic_descriptor_5</th>
<th data-quarto-table-cell-role="th">geographic_descriptor_6</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>Ciudad de Huamanga</td>
<td>Aucara</td>
<td>NaN</td>
<td>NaN</td>
<td>Aucara</td>
<td>NaN</td>
<td>Huamanga</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>Aucara</td>
<td>NaN</td>
<td>Colca</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>Pampamarca</td>
<td>NaN</td>
<td>Pampamarca</td>
<td>NaN</td>
<td>Aucara</td>
<td>NaN</td>
<td>Pampamarca</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>Pampamarca</td>
<td>NaN</td>
<td>Pampamarca</td>
<td>NaN</td>
<td>Pampamarca|santa iglesia</td>
<td>NaN</td>
<td>Pampamarca</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>Pampamarca|santa iglesia</td>
<td>NaN</td>
<td>Pampamarca</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">1714</td>
<td>Pampamarca</td>
<td>NaN</td>
<td>Pampamarca</td>
<td>NaN</td>
<td>Pampamarca</td>
<td>NaN</td>
<td>Pampamarca</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1715</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">1716</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1717</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>Aucara</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">1718</td>
<td>Pampamarca</td>
<td>NaN</td>
<td>Pampamarca</td>
<td>NaN</td>
<td>Pampamarca</td>
<td>NaN</td>
<td>Pampamarca</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
</tr>
</tbody>
</table>

<p>1719 rows × 11 columns</p>
</div>
</div>
</div>
<div id="2fdcaf47" class="cell" data-execution_count="30">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>entierros_place_columns <span class="op">=</span> [</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">'place'</span>, <span class="st">'deceased_hometown'</span>, <span class="st">'burial_place'</span>, <span class="st">'geographic_descriptor_1'</span>,</span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">'geographic_descriptor_2'</span>, <span class="st">'geographic_descriptor_3'</span>,</span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">'geographic_descriptor_4'</span></span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a>ENTIERROS_PLACES_RAW <span class="op">=</span> ENTIERROS_HARMONIZED[entierros_place_columns]</span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-9"><a href="#cb35-9" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> col <span class="kw">in</span> entierros_place_columns:</span>
<span id="cb35-10"><a href="#cb35-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> col <span class="kw">in</span> ENTIERROS_HARMONIZED.columns:</span>
<span id="cb35-11"><a href="#cb35-11" aria-hidden="true" tabindex="-1"></a>        ENTIERROS_HARMONIZED[col] <span class="op">=</span> extractor.extract_places_per_row(ENTIERROS_HARMONIZED[col])</span>
<span id="cb35-12"><a href="#cb35-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-13"><a href="#cb35-13" aria-hidden="true" tabindex="-1"></a>ENTIERROS_HARMONIZED[entierros_place_columns]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="30">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">place</th>
<th data-quarto-table-cell-role="th">deceased_hometown</th>
<th data-quarto-table-cell-role="th">burial_place</th>
<th data-quarto-table-cell-role="th">geographic_descriptor_1</th>
<th data-quarto-table-cell-role="th">geographic_descriptor_2</th>
<th data-quarto-table-cell-role="th">geographic_descriptor_3</th>
<th data-quarto-table-cell-role="th">geographic_descriptor_4</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>Lucanas</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>Lucanas</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>Lucanas</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>Lucanas</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>Lucanas</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2193</td>
<td>Aucara</td>
<td>Santa Ana de Aucara</td>
<td>NaN</td>
<td>NaN</td>
<td>Santa Ana de Aucara</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2194</td>
<td>Aucara</td>
<td>Pampamarca</td>
<td>NaN</td>
<td>NaN</td>
<td>Pampamarca</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2195</td>
<td>Aucara</td>
<td>Santa Ana de Aucara</td>
<td>NaN</td>
<td>NaN</td>
<td>Santa Ana de Aucara</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2196</td>
<td>Aucara</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2197</td>
<td>Aucara</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
</tr>
</tbody>
</table>

<p>2198 rows × 7 columns</p>
</div>
</div>
</div>
<div id="d67452f6" class="cell" data-execution_count="31">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="co"># save raw places</span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> utils <span class="im">import</span> UniqueValues</span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a>uniqueValues <span class="op">=</span> UniqueValues.UniqueValuesExtractor(</span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a>    [BAUTISMOS_PLACES_RAW, MATRIMONIOS_PLACES_RAW, ENTIERROS_PLACES_RAW]</span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a>).get_unique_values(return_dataframe<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb36-8"><a href="#cb36-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-9"><a href="#cb36-9" aria-hidden="true" tabindex="-1"></a>uniqueValues.to_csv(<span class="st">"../data/raw/raw_places.csv"</span>, index<span class="op">=</span><span class="va">False</span>) <span class="co"># type: ignore # </span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="cleaning-audit" class="level2">
<h2 class="anchored" data-anchor-id="cleaning-audit">Cleaning Audit</h2>
<p>Basic audit to ensure that the data cleaning process has been successful.</p>
<div id="8d22779b" class="cell" data-execution_count="32">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> cleaning_audit(df, name):</span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>    audit <span class="op">=</span> {}</span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a>    <span class="co"># General info</span></span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a>    audit[<span class="st">"dataset"</span>] <span class="op">=</span> name</span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a>    audit[<span class="st">"n_rows"</span>] <span class="op">=</span> df.shape[<span class="dv">0</span>]</span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a>    audit[<span class="st">"n_columns"</span>] <span class="op">=</span> df.shape[<span class="dv">1</span>]</span>
<span id="cb37-8"><a href="#cb37-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-9"><a href="#cb37-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Missing values summary</span></span>
<span id="cb37-10"><a href="#cb37-10" aria-hidden="true" tabindex="-1"></a>    missing <span class="op">=</span> df.isnull().<span class="bu">sum</span>()</span>
<span id="cb37-11"><a href="#cb37-11" aria-hidden="true" tabindex="-1"></a>    missing_percent <span class="op">=</span> (missing <span class="op">/</span> df.shape[<span class="dv">0</span>]) <span class="op">*</span> <span class="dv">100</span></span>
<span id="cb37-12"><a href="#cb37-12" aria-hidden="true" tabindex="-1"></a>    audit[<span class="st">"missing_values"</span>] <span class="op">=</span> missing[missing <span class="op">&gt;</span> <span class="dv">0</span>].sort_values(ascending<span class="op">=</span><span class="va">False</span>).to_dict()</span>
<span id="cb37-13"><a href="#cb37-13" aria-hidden="true" tabindex="-1"></a>    audit[<span class="st">"missing_percent"</span>] <span class="op">=</span> missing_percent[missing_percent <span class="op">&gt;</span> <span class="dv">0</span>].sort_values(ascending<span class="op">=</span><span class="va">False</span>).<span class="bu">round</span>(<span class="dv">1</span>).to_dict()</span>
<span id="cb37-14"><a href="#cb37-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-15"><a href="#cb37-15" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Check for non-standard values in key columns if they exist</span></span>
<span id="cb37-16"><a href="#cb37-16" aria-hidden="true" tabindex="-1"></a>    columns_of_interest <span class="op">=</span> [<span class="st">"baptism_place"</span>, <span class="st">"burial_place"</span>, <span class="st">"wedding_place"</span>,</span>
<span id="cb37-17"><a href="#cb37-17" aria-hidden="true" tabindex="-1"></a>                           <span class="st">"baptized_legitimacy_status"</span>, <span class="st">"burial_condition"</span>, <span class="st">"groom_condition"</span>, <span class="st">"bride_condition"</span>]</span>
<span id="cb37-18"><a href="#cb37-18" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb37-19"><a href="#cb37-19" aria-hidden="true" tabindex="-1"></a>    unique_values <span class="op">=</span> {}</span>
<span id="cb37-20"><a href="#cb37-20" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> col <span class="kw">in</span> columns_of_interest:</span>
<span id="cb37-21"><a href="#cb37-21" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> col <span class="kw">in</span> df.columns:</span>
<span id="cb37-22"><a href="#cb37-22" aria-hidden="true" tabindex="-1"></a>            unique_values[col] <span class="op">=</span> df[col].dropna().unique().tolist()</span>
<span id="cb37-23"><a href="#cb37-23" aria-hidden="true" tabindex="-1"></a>    audit[<span class="st">"non_standard_values"</span>] <span class="op">=</span> unique_values</span>
<span id="cb37-24"><a href="#cb37-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-25"><a href="#cb37-25" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> audit</span>
<span id="cb37-26"><a href="#cb37-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-27"><a href="#cb37-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-28"><a href="#cb37-28" aria-hidden="true" tabindex="-1"></a>bautismos_audit <span class="op">=</span> cleaning_audit(BAUTISMOS_HARMONIZED, <span class="st">"Bautismos"</span>)</span>
<span id="cb37-29"><a href="#cb37-29" aria-hidden="true" tabindex="-1"></a>matrimonios_audit <span class="op">=</span> cleaning_audit(MATRIMONIOS_HARMONIZED, <span class="st">"Matrimonios"</span>)</span>
<span id="cb37-30"><a href="#cb37-30" aria-hidden="true" tabindex="-1"></a>entierros_audit <span class="op">=</span> cleaning_audit(ENTIERROS_HARMONIZED, <span class="st">"Entierros"</span>)</span>
<span id="cb37-31"><a href="#cb37-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-32"><a href="#cb37-32" aria-hidden="true" tabindex="-1"></a>audits <span class="op">=</span> [bautismos_audit, matrimonios_audit, entierros_audit]</span>
<span id="cb37-33"><a href="#cb37-33" aria-hidden="true" tabindex="-1"></a>audits</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="32">
<pre><code>[{'dataset': 'Bautismos',
  'n_rows': 6341,
  'n_columns': 26,
  'missing_values': {'geographic_descriptor_4': 6339,
   'geographic_descriptor_1': 6288,
   'geographic_descriptor_3': 6267,
   'godfather_social_condition': 6228,
   'godmother_social_condition': 5977,
   'father_social_condition': 5511,
   'baptized_hometown': 5494,
   'mother_social_condition': 5374,
   'geographic_descriptor_2': 4491,
   'parents_social_condition': 4067,
   'godfather_lastname': 3345,
   'godfather_name': 3338,
   'godmother_lastname': 3108,
   'godmother_name': 3098,
   'baptism_place': 2712,
   'baptized_birth_date': 984,
   'father_name': 284,
   'father_lastname': 281,
   'mother_lastname': 73,
   'mother_name': 37,
   'baptized_legitimacy_status': 13,
   'baptized_name': 5,
   'date': 3},
  'missing_percent': {'geographic_descriptor_4': 100.0,
   'geographic_descriptor_1': 99.2,
   'geographic_descriptor_3': 98.8,
   'godfather_social_condition': 98.2,
   'godmother_social_condition': 94.3,
   'father_social_condition': 86.9,
   'baptized_hometown': 86.6,
   'mother_social_condition': 84.8,
   'geographic_descriptor_2': 70.8,
   'parents_social_condition': 64.1,
   'godfather_lastname': 52.8,
   'godfather_name': 52.6,
   'godmother_lastname': 49.0,
   'godmother_name': 48.9,
   'baptism_place': 42.8,
   'baptized_birth_date': 15.5,
   'father_name': 4.5,
   'father_lastname': 4.4,
   'mother_lastname': 1.2,
   'mother_name': 0.6,
   'baptized_legitimacy_status': 0.2,
   'baptized_name': 0.1,
   'date': 0.0},
  'non_standard_values': {'baptism_place': ['Pampamarca',
    'Aucara',
    'Chacralla',
    'Ishua',
    'Ishua|santa iglesia',
    'Pampamarca|santa iglesia',
    'Chacralla|iglesia santa',
    'Pampamarca|santa iglesia viceparroquial',
    'Ishua|santa iglesia viceparroquial',
    'Cabana',
    'Huaycahuacho',
    'Cabana|santa iglesia',
    'Pampamarca|santa iglesia|viceparroquial',
    'Chacralla|viceparroquial',
    'Ishua|santa iglesia viceparroquia',
    'Pampamarca|santa iglesia viceparroquia',
    'parroquia de|Aucará',
    'Parroquia de Aucará',
    'Viceparroquia de Pampamarca',
    'Yshua',
    'Viceparroquia de Chacralla',
    'Pampamarca|Aucará',
    'Chacralla|Aucará',
    'Yshua|Aucará',
    'Templo de Aucará',
    'Iglesia de Aucará',
    'Aucará',
    'Iglesia de  Aucará',
    'Iglesia de Pampamarca',
    'Iglesia de Yshua',
    'Iglesia Parroquial de Pampamarca'],
   'baptized_legitimacy_status': ['Hijo legitimo',
    'Hija legitima',
    'Hija natural',
    'Hijo natural',
    'hija legítima',
    'hijo legitimo',
    'hija natural',
    'hijo natural',
    'hija legitima',
    'tributario',
    'hijo legitimo. Natural',
    'hija legitima. Natural',
    'hija legitimo',
    '¿hija legitima?',
    'hijo adultero',
    'hijo.',
    'hijos naturales',
    'hijas naturales',
    'Español. Hijo natural',
    'Indio de Pampamarca. Hijo legitimo',
    'India. Hija legitima',
    'India de Ishua. Hija legigtima',
    'Indio de Ishua. Hijo legitimo',
    'Española',
    'Española de San Juan. Hija natural',
    'India de Chacralla. Hija legitima',
    'India de las punas de Huanacopampa. Hija legitima',
    'indio. Hijo legitimo',
    'Indio de Aucara. Hijo legitimo',
    'Indio. Hijo legitimo',
    'India de Pampamarca. Hija legitima',
    'Indio de Chacralla. Hijo legitimo',
    'India de Aucara. Hija legitima',
    'Indio de la puna. Hijo Legitimo',
    'India de Ishua. Hija legitima',
    'Español de Chacralla. Hijo natural',
    'India de las punas de Aucara. Hija legitima',
    'Indio de Pampamarca. Hijo natural',
    'Indio de Aucara. Hijo natural',
    'Española. Hija natural ',
    'Indio de la puna. Hijo legitimo',
    'Indio de las punas de Aucara. Hijo legitimo',
    'Indio de Huaycahuacho. Hijo Legitimo',
    'Española. Hija legitima',
    'Español de Chacralla. Hijo legitimo',
    'Indio de Huanca. Hijo legitimo',
    'India de Ishua. Hija natural',
    'Español de Aucara. Hijo legitimo',
    'Indio de Chacralla. Hijo natural',
    'Indio. Hijo natural',
    'Indio de Huanacopampa. Hijo legitimo',
    'Español de Aucara. Hijo natural',
    'India de Chacralla. Hija natural',
    'Indio de Urabamba, Hijo legitimo',
    'India de Chaupicancha. Hija legitima',
    'Española de Aucara. Hija legitima',
    'Indio de Puquio. Hijo legitimo',
    'Indio de Visvicha. Hijo legitimo',
    'Indio de la doctrina de Aucara. Hijo legitimo',
    'Español de la doctrina de Aucara. Hijo legitimo',
    'Natural de Ishua. Hijo legitimo',
    'Tributaria de Aucara. Hija legitima',
    'Tributaria de Ishua. Hija legitima',
    'Tributario de Chacralla. Hijo natural',
    'Tributario de Pampamarca. Hijo legitimo',
    'Tributaria de Pampamarca. Hija legitima',
    'Tributario de Aucara. Hijo legitimo',
    'Tributario de Chacralla. Hijo legitimo',
    'Tributaria de Chacralla. Hija legitima',
    'Español. Hijo legitimo',
    'Tributario de Chacralla. Hija legitima',
    'Tributario de Aucara. Hijo natural',
    'Hija (sic)',
    'Expuesto',
    'hijo legítimo',
    'hijo legítimo y español',
    'hijo legítimo, español',
    'español, hijo legítimo',
    'española, hija legítima',
    'hijo natural, indio',
    'hija legítima, india',
    'hijo legítimo, indio',
    'hijo natural, español',
    'hija natural, india',
    '[ilegible]',
    'hija legítima, indigena',
    'hijo legítimo, indígena de la Puna',
    'hijo legitimo, indio',
    'hija legítima, indio',
    'hija legítima, mestiza',
    'hijo legítimo, mestizo',
    'hijos legítimos, españoles, mellizos',
    'hija natural, española',
    'hija legítima, indígena',
    'hijo legítimo, indígena',
    'hija natural, mestiza',
    'hija legítima, española',
    'indio',
    'hijo legítimo, contribuyente',
    'hijo natural, [esp]añol',
    'hijo natural, mestizo',
    'hijo natural, indígena',
    'hijo legítimo, blanco',
    'hijo legítimo, indio neto',
    'hija legítima, india neta',
    'hija espuria',
    '"hijo espurio de Carmelon Lopez y, natural de Fuljencia Roda"',
    'hijo espurio',
    'hija legítima, señorita',
    'hijo legítimo, india',
    'hija natural, indígena',
    'india, hija natural',
    'hijo natural, vecino',
    'hijo legítimo, "vecino de id. [Chacralla]"',
    'hija espuria, india',
    '"h.l. [hija legítima]", india',
    '"h.l. [hijo legítimo]", indio',
    '"h. legítimo", indio',
    '"h.l. [hijo legítimo]", vecino de Aucara',
    '"h.l. [hijo legítimo]", "indio de id. [Aucara]"',
    '"h.l. [hija legítima]", española',
    '"h.l. [hijo legítimo]", indígena',
    '"h.l. [hija legítima]", indígena',
    '"h.l. [hija legítima]", "vecino de id. [Pampamarca]"',
    '"h.l. [hijo legítimo]", "vecino de id. [Pampamarca]"',
    '"h.n. [hijo natural]", indio',
    '"hijo desconocido, y espuesto a las  puertas de su padrino", "vecino de id. [Chacralla]"',
    '"h.n. [hija natural]", india',
    '"h.l. [hija legítima]", indio',
    '"h.n. [hija natural]"',
    '"h.l. [hija legítima]", "vecina de id. [Chapa]"',
    '"h.l. [hijo legítimo]", india',
    '"h.l. [hijo legítimo]", "vecino de id. [Chacralla]"',
    'hija legítima, gemelos',
    'hija legítima, indígena, india',
    'hijo legítimo, indígena, indio',
    'hija natural, indigena, mestizo',
    'hija legítima, indígena, [in]dia',
    'hijo natural, indígena, indio',
    'hija natural, indígena, india',
    'hijo legítimo, indígena, [in]dio',
    'hijo legítimo, indígena, mestizo',
    'hija legítima, española, mestizo',
    'hijo legítimo, indio, indígena',
    'hijo legítimo, indígena [?]',
    'hijo legítima, español',
    'hija espuria, mestiza',
    'hija legítima, "indijena [sic]"',
    'hijo legítimo, "indijena [sic]"',
    'hijo espurio, español',
    'hijo legítimo, español, "indijena [sic]"',
    'hijo natural, "indijena [sic]"',
    'hija natural, "indijena [sic]"',
    'hija espuria, española',
    'hija legítima [?], "indijena [sic]"',
    'hijo legítimo, "indíjena [sic]"',
    'hijo legítimo, "índijena [sic]"',
    'hija legítima, "índijena [sic]"',
    'hija natural, "indijina [sic]"',
    'hijos legítimos, gemelos',
    'hija legítima, "indijina [sic]"',
    'hijo legítimo, "indijino [sic]"',
    'hijo natural, "indijino [sic]"',
    'hijo legítimo, "indijina [sic]"',
    'hijo natural, "indijina [sic]"',
    'hijo legítima, española',
    'hijo legítimo, "inds. [indios] Ishua"',
    'hijo natural, "indijina [sic] de Ishua"',
    'hija natural, "yndijena [sic]"',
    'hija espuria, "indijina [sic]"',
    '"hijo legítimo", "indijina [sic]"',
    'hijo legítima, "indijino [sic]"',
    'hijo legítimo, española',
    '"hija lejma. [legítima]"',
    '"hijo lejmo. [legítimo]"',
    '"hijo [sic]"',
    'hijo natural, "yndígino [sic]"',
    'hijo legítimo, indio, "indíjino [sic]"',
    'hija legítima, india, "indígina [sic]"',
    'hijo legítimo, "indígino [sic]"',
    'hijo legítimo, "yndígino [sic]"',
    'hijo natural, "indígino [sic]"',
    'hija natural, "indígina [sic]"',
    'hija legítima, "indígina [sic]"',
    'hijo legítimo, "indo. [indio] de Chacralla [sic]"',
    'hija legítima, "inda. [india]"',
    '"hija [sic]", "inda. [india]"',
    'hijo legítimo, "indo. [indio]"',
    'hijo espurio, "indo. [indio]"',
    '"hijo létimo [legítimo]", "indíjino [sic]"',
    'hijo legítimo, "indios [sic]"',
    'hijo legítimo, "indígino [sic] de Ishua"',
    'hijo legítimo, "indigino [sic]"',
    'hija legítima, "indíjina [sic]"',
    'hijo natural, "indíjino [sic]"',
    'hijo legítimo, "indíjina [sic]"',
    'hija legítima, "[in]díjina [sic]"',
    'hijo legítimo, "indíjino [sic]"',
    'hijo legítimo, "espñl. [español]"',
    'hija legítima, "espl. [español]"',
    'hija legítima, "indios [sic]"',
    'hija legítima, "español [sic]"',
    '"hijo [sic]", indio',
    '"hijo adoptivo de padre", "español de Chipao"',
    'hijo natural, "indio de Ishua"',
    'hijo legítimo, "indio de Ishua"',
    'hijo legítimo, "indio de Chacralla"',
    'hija legítima, "india de Pampamarca"',
    'hijo legítimo, "indio de Pampamarca"',
    'hija espuria, "india de Aucara"',
    'hija legítima, "india de Ishua"',
    'hija natural, "indios de Pampamarca"',
    'hija legítima, "india de Chihuire"',
    'hija legítima, "india de Tallcce"',
    'hijo legítimo, "indio de Mayo"',
    'hija legítima, "[espa]ñola de Aucara"',
    'hija adoptiva, "española de Aucara"',
    'hijo natural, "indio de Pampamarca"',
    'hija legítima, "india de Mayo"',
    'hija legítima, "india de Ccaralla"',
    'hija natural, "india de Pampamarca"',
    'hijo adoptivo, "indio de Pampamarca"',
    '"hija natural de Daniel Romero [padre] y espuria de Clara Acharte [madre]", "española de Aucara"',
    'hija legítima, "española de Aucara"',
    'hijo legítimo, "indio de Chapa"',
    'hijo legítimo, "indio de Aucara"',
    'hijo legítimo, "india de Chapa"',
    'hijo legítimo, "indio de Pincocalla"',
    'hija legítima, "india de Chacralla"',
    'hija legítima, "india de Aucara"',
    'hija legítima, "india de Aucara y Ayacucho"',
    'hijo legítimo, "indios de Cangallo y Aucara"',
    'hijo legítimo, "indio de Ccaralla"',
    'hijo legítimo, "indio de Tallcce"',
    'hija legítima, "india de Chapa"',
    '"hijo natural de Daniel Romero [su padre] y espurio de Dionicia N. [su madre"',
    'hijo natural, "natural de Pampamarca"',
    'hijo natural, "natural de Aucara"',
    'hija legítima, "natural de Aucara"',
    '"hija legítima de Estévan Ramos [su padre] y espuria de Josefa Chinchay [su madre]", "natural de Aucara"',
    'hijo legítimo, "natural de Pampamarca"',
    'hijo legítimo, "natural de Ishua"',
    'hija legítima, "natural de Cabana"',
    'hijo legítimo, "natural de Aucara"',
    'hija legítima, "natural de Ishua"',
    'hija legítima, "natural de Chacralla"',
    'hijo legítimo, "natural de Tallcce"',
    'hijo espurio, "natural de Aucara"',
    'hija natural, "natural de Chacralla"',
    'hijo legítimo, "naturales de Ishua"',
    'hija legítima, "naturales de Ishua"',
    '"hija [sic]"',
    'hija legítima, "indio [sic]"',
    'hija legítima, "indio"',
    'hijo legítimo, "india"',
    'hija natural, "indio"',
    '"hija legítimo [sic]", indio',
    '"hijo legítimo", india',
    'hijo legítimo, [in]dio',
    'hija legítima, "español"',
    '"hijo legítima [sic]", indio',
    '"hijo legítima [sic]", india',
    'hija legítima, i[n]dia',
    'Hija legítima',
    'Hijo legítimo',
    'Hijo',
    'Hija espuria',
    'Hija',
    'Hijo Natural',
    'Hijo legítimo/español',
    'Hijo espurio',
    'Hija ',
    'Hijo legítimo, Español',
    'Hijo legítimo, indio',
    'Hija legítima, india',
    'Hijo no conocido',
    'Hija de padre no conocido',
    'Hija legítima, indio',
    'Hijo de padre noconocido',
    'Hija  natural',
    'vecino/Hijo legítimo',
    'Hijo natural, indio',
    'Hija legítima, blanca',
    'Hija natural, india',
    'Hijo legítimo, vecino',
    'Hija legítima, vecina',
    'Hija legitima, vecina',
    'Hijo natural, vecino',
    ' Hijo natural',
    'hijo, indio',
    'Hijo legítimo, vecina',
    'Hija natural, vesina',
    'Hijo legítimo, vesino',
    'Hijo legítimo, español',
    'Hijo legítimo, indio de las punas',
    'Hijo natural, español',
    'Hija legítima, española',
    'Hija legítima, indígena',
    'Hija legítima, "in. b."  [indio blanco]',
    'Hija natural, indio',
    'Hijo legítimo, blanco',
    'Hija natural, blanca',
    'Hijo natural, blanco',
    'Hijo asporio (sic)',
    'Hija legítima, Mellisa',
    'Hija no conocida',
    'Hijo legítimo, mestiso ',
    'Hijo natural, mestizo',
    'Hija legítima, india forastero',
    'Hijo natural indio',
    'Hijo legítimo, mestizo',
    'Hija legítima, mestizo',
    'Hija legítima, Española',
    'Hijo espurio, español',
    'Hija natural, española',
    'Hijo, indio',
    'Hija natural, gemela',
    'Hija legítima, indigna',
    'Hijo legítimo, indigna',
    'Hija legítima, mestiza',
    'Hijo natural, mestiza']}},
 {'dataset': 'Matrimonios',
  'n_rows': 1719,
  'n_columns': 55,
  'missing_values': {'geographic_descriptor_6': 1719,
   'geographic_descriptor_5': 1718,
   'geographic_descriptor_1': 1717,
   'godparent_3_name': 1716,
   'godparent_3_lastname': 1716,
   'geographic_descriptor_4': 1709,
   'witness_4_name': 1695,
   'witness_4_lastname': 1695,
   'godparent_2_social_condition': 1566,
   'godparent_1_social_condition': 1541,
   'geographic_descriptor_3': 1532,
   'groom_resident_in': 1521,
   'bride_resident_in': 1518,
   'groom_hometown': 1311,
   'bride_hometown': 1304,
   'bride_father_social_condition': 1143,
   'bride_mother_social_condition': 1136,
   'groom_father_social_condition': 1123,
   'groom_mother_social_condition': 1120,
   'bride_age': 1110,
   'groom_age': 1093,
   'geographic_descriptor_2': 793,
   'witness_3_lastname': 778,
   'witness_3_name': 778,
   'bride_social_condition': 731,
   'groom_social_condition': 691,
   'groom_father_lastname': 352,
   'bride_father_lastname': 325,
   'groom_father_name': 311,
   'groom_legitimacy_status': 303,
   'groom_mother_lastname': 284,
   'bride_father_name': 282,
   'groom_mother_name': 281,
   'bride_legitimacy_status': 277,
   'bride_mother_lastname': 266,
   'bride_mother_name': 261,
   'bride_marital_status': 245,
   'groom_marital_status': 214,
   'godparent_2_lastname': 144,
   'godparent_2_name': 137,
   'witness_2_lastname': 86,
   'witness_2_name': 81,
   'marriage_place': 80,
   'witness_1_lastname': 76,
   'witness_1_name': 75,
   'godparent_1_lastname': 47,
   'godparent_1_name': 46,
   'bride_lastname': 4,
   'groom_lastname': 4,
   'bride_name': 2,
   'groom_name': 1,
   'date': 1},
  'missing_percent': {'geographic_descriptor_6': 100.0,
   'geographic_descriptor_5': 99.9,
   'geographic_descriptor_1': 99.9,
   'godparent_3_name': 99.8,
   'godparent_3_lastname': 99.8,
   'geographic_descriptor_4': 99.4,
   'witness_4_name': 98.6,
   'witness_4_lastname': 98.6,
   'godparent_2_social_condition': 91.1,
   'godparent_1_social_condition': 89.6,
   'geographic_descriptor_3': 89.1,
   'groom_resident_in': 88.5,
   'bride_resident_in': 88.3,
   'groom_hometown': 76.3,
   'bride_hometown': 75.9,
   'bride_father_social_condition': 66.5,
   'bride_mother_social_condition': 66.1,
   'groom_father_social_condition': 65.3,
   'groom_mother_social_condition': 65.2,
   'bride_age': 64.6,
   'groom_age': 63.6,
   'geographic_descriptor_2': 46.1,
   'witness_3_lastname': 45.3,
   'witness_3_name': 45.3,
   'bride_social_condition': 42.5,
   'groom_social_condition': 40.2,
   'groom_father_lastname': 20.5,
   'bride_father_lastname': 18.9,
   'groom_father_name': 18.1,
   'groom_legitimacy_status': 17.6,
   'groom_mother_lastname': 16.5,
   'bride_father_name': 16.4,
   'groom_mother_name': 16.3,
   'bride_legitimacy_status': 16.1,
   'bride_mother_lastname': 15.5,
   'bride_mother_name': 15.2,
   'bride_marital_status': 14.3,
   'groom_marital_status': 12.4,
   'godparent_2_lastname': 8.4,
   'godparent_2_name': 8.0,
   'witness_2_lastname': 5.0,
   'witness_2_name': 4.7,
   'marriage_place': 4.7,
   'witness_1_lastname': 4.4,
   'witness_1_name': 4.4,
   'godparent_1_lastname': 2.7,
   'godparent_1_name': 2.7,
   'bride_lastname': 0.2,
   'groom_lastname': 0.2,
   'bride_name': 0.1,
   'groom_name': 0.1,
   'date': 0.1},
  'non_standard_values': {}},
 {'dataset': 'Entierros',
  'n_rows': 2198,
  'n_columns': 24,
  'missing_values': {'geographic_descriptor_4': 2198,
   'geographic_descriptor_1': 2198,
   'geographic_descriptor_3': 1928,
   'husband_name': 1865,
   'wife_name': 1853,
   'deceased_hometown': 1538,
   'burial_place': 1523,
   'place': 1415,
   'deceased_legitimacy_status': 1119,
   'deceased_marital_status': 923,
   'mother_lastname': 915,
   'father_name': 906,
   'father_lastname': 905,
   'geographic_descriptor_2': 901,
   'mother_name': 897,
   'deceased_age': 790,
   'deceased_condition': 564,
   'deceased_lastname': 127,
   'doctrine': 87,
   'date': 81,
   'deceased_name': 78,
   'event_type': 74,
   'identifier': 6,
   'file': 6},
  'missing_percent': {'geographic_descriptor_4': 100.0,
   'geographic_descriptor_1': 100.0,
   'geographic_descriptor_3': 87.7,
   'husband_name': 84.8,
   'wife_name': 84.3,
   'deceased_hometown': 70.0,
   'burial_place': 69.3,
   'place': 64.4,
   'deceased_legitimacy_status': 50.9,
   'deceased_marital_status': 42.0,
   'mother_lastname': 41.6,
   'father_name': 41.2,
   'father_lastname': 41.2,
   'geographic_descriptor_2': 41.0,
   'mother_name': 40.8,
   'deceased_age': 35.9,
   'deceased_condition': 25.7,
   'deceased_lastname': 5.8,
   'doctrine': 4.0,
   'date': 3.7,
   'deceased_name': 3.5,
   'event_type': 3.4,
   'identifier': 0.3,
   'file': 0.3},
  'non_standard_values': {'burial_place': ['Pampamarca',
    'Cementerio general de la Vice|Pampamarca',
    'Cementerio general de la Vice|Chacralla',
    'Cementerio general de Aucara',
    'Cementerio general de la Vice|Yshua',
    'Viceparroquia de Pampamarca',
    'Yshua',
    'Cabana',
    'Cementerio General de Aucará',
    'Cementerio de las Punas de Visvicha',
    'Cementerio de Aucará',
    'Cementerio de Pampamarca',
    'Cementerio de Visvicha',
    'Cementerio general de Pampamarca',
    'Cementerio general  Chacralla',
    'Cementerio general  Pampamarca',
    'Cementerio general  Aucará',
    'Chipau',
    'Aucara|Cementerio General',
    'Chacralla',
    'Santa Ana de Aucara',
    'Aucara',
    'Pampamarca|Cementerio General',
    'Cementerio General',
    'General',
    'Umasi']}}]</code></pre>
</div>
</div>
</section>
<section id="save-cleaned-data" class="level2">
<h2 class="anchored" data-anchor-id="save-cleaned-data">Save Cleaned Data</h2>
<div id="1b72bc08" class="cell" data-execution_count="33">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>clean_data_folder <span class="op">=</span> Path(<span class="st">"../data/clean/"</span>)</span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Fill NaN values for consistency</span></span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a>BAUTISMOS_HARMONIZED <span class="op">=</span> BAUTISMOS_HARMONIZED.fillna(value<span class="op">=</span>np.nan)</span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a>MATRIMONIOS_HARMONIZED <span class="op">=</span> MATRIMONIOS_HARMONIZED.fillna(value<span class="op">=</span>np.nan)</span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a>ENTIERROS_HARMONIZED <span class="op">=</span> ENTIERROS_HARMONIZED.fillna(value<span class="op">=</span>np.nan)</span>
<span id="cb39-7"><a href="#cb39-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-8"><a href="#cb39-8" aria-hidden="true" tabindex="-1"></a>BAUTISMOS_HARMONIZED.to_csv(clean_data_folder <span class="op">/</span> <span class="st">"bautismos_clean.csv"</span>, index<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb39-9"><a href="#cb39-9" aria-hidden="true" tabindex="-1"></a>MATRIMONIOS_HARMONIZED.to_csv(clean_data_folder <span class="op">/</span> <span class="st">"matrimonios_clean.csv"</span>, index<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb39-10"><a href="#cb39-10" aria-hidden="true" tabindex="-1"></a>ENTIERROS_HARMONIZED.to_csv(clean_data_folder <span class="op">/</span> <span class="st">"entierros_clean.csv"</span>, index<span class="op">=</span><span class="va">False</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>